import{_ as s,o as a,c as n,aA as e}from"./chunks/framework.A7OkVGlh.js";const E=JSON.parse('{"title":"Channel Repair","description":"","frontmatter":{},"headers":[],"relativePath":"demos/channel_repair.md","filePath":"demos/channel_repair.md","lastUpdated":null}'),l={name:"demos/channel_repair.md"};function t(h,i,p,r,k,o){return a(),n("div",null,[...i[0]||(i[0]=[e(`<h1 id="Channel-Repair" tabindex="-1">Channel Repair <a class="header-anchor" href="#Channel-Repair" aria-label="Permalink to &quot;Channel Repair {#Channel-Repair}&quot;">​</a></h1><p>This demo demonstrates channel interpolation methods for repairing bad electrodes using spatial interpolation techniques.</p><p>This demo demonstrates channel interpolation methods for repairing bad electrodes using spatial interpolation techniques.</p><h3 id="What-is-Channel-Repair?" tabindex="-1">What is Channel Repair? <a class="header-anchor" href="#What-is-Channel-Repair?" aria-label="Permalink to &quot;What is Channel Repair? {#What-is-Channel-Repair?}&quot;">​</a></h3><p>Channel repair (interpolation) estimates the signal at bad electrodes using data from neighboring good channels. This preserves data quality while maintaining electrode count for spatial analyses.</p><h3 id="When-to-Repair-Channels" tabindex="-1">When to Repair Channels <a class="header-anchor" href="#When-to-Repair-Channels" aria-label="Permalink to &quot;When to Repair Channels {#When-to-Repair-Channels}&quot;">​</a></h3><p>Channel repair is appropriate when:</p><ul><li><p>Individual electrodes have poor contact or high impedance</p></li><li><p>Isolated channels show excessive noise or artifacts</p></li><li><p>A small number of channels are affected while most data is clean</p></li><li><p>You need to maintain electrode count for spatial analyses (e.g., source localization)</p></li></ul><p><strong>Do not repair</strong> when:</p><ul><li><p>Too many channels are bad (&gt;10-15% of total)</p></li><li><p>The entire dataset is noisy</p></li><li><p>Bad channels cluster together spatially</p></li><li><p>Channel shows intermittent problems (repair won&#39;t fix instability)</p></li></ul><h3 id="Interpolation-Methods" tabindex="-1">Interpolation Methods <a class="header-anchor" href="#Interpolation-Methods" aria-label="Permalink to &quot;Interpolation Methods {#Interpolation-Methods}&quot;">​</a></h3><p><strong>Neighbor Interpolation</strong>:</p><ul><li><p>Weighted average of spatially nearby electrodes</p></li><li><p>Fast and computationally efficient</p></li><li><p>Good for isolated bad channels</p></li><li><p>Requires neighbor calculation based on distance threshold</p></li></ul><p><strong>Spherical Spline</strong>:</p><ul><li><p>Uses spherical spline functions to model scalp potential distribution</p></li><li><p>More accurate spatial interpolation</p></li><li><p>Preserves topographic patterns better</p></li><li><p>Recommended for publication-quality analyses</p></li></ul><h3 id="Best-Practices" tabindex="-1">Best Practices <a class="header-anchor" href="#Best-Practices" aria-label="Permalink to &quot;Best Practices {#Best-Practices}&quot;">​</a></h3><p><strong>Timing</strong>:</p><ul><li><p>Identify bad channels using quality metrics first</p></li><li><p>Repair before re-referencing (reference calculation needs all channels)</p></li><li><p>Repair before averaging or statistical analysis</p></li></ul><p><strong>Limits</strong>:</p><ul><li><p>Avoid interpolating too many channels (&gt;10% is problematic)</p></li><li><p>Document exact number and labels of repaired channels in methods</p></li><li><p>Consider rejecting datasets with excessive bad channels</p></li></ul><p><strong>Validation</strong>:</p><ul><li><p>Visually verify repair quality (before/after comparison)</p></li><li><p>Check that interpolated channels match neighbors</p></li><li><p>Review repair plots to confirm successful interpolation</p></li></ul><h2 id="Workflow-Summary" tabindex="-1">Workflow Summary <a class="header-anchor" href="#Workflow-Summary" aria-label="Permalink to &quot;Workflow Summary {#Workflow-Summary}&quot;">​</a></h2><p>This demo shows channel repair workflows:</p><h3 id="1.-Identify-Channels-to-Repair" tabindex="-1">1. Identify Channels to Repair <a class="header-anchor" href="#1.-Identify-Channels-to-Repair" aria-label="Permalink to &quot;1. Identify Channels to Repair {#1.-Identify-Channels-to-Repair}&quot;">​</a></h3><ul><li><p>Load and preprocess data</p></li><li><p>Select specific channels for demonstration</p></li><li><p>Verify channels exist in the dataset</p></li></ul><h3 id="2.-Calculate-Neighbor-Relationships" tabindex="-1">2. Calculate Neighbor Relationships <a class="header-anchor" href="#2.-Calculate-Neighbor-Relationships" aria-label="Permalink to &quot;2. Calculate Neighbor Relationships {#2.-Calculate-Neighbor-Relationships}&quot;">​</a></h3><ul><li><p>Compute spatial neighbors based on 3D electrode positions</p></li><li><p>Use distance threshold to define neighborhood</p></li><li><p>Required for neighbor interpolation method</p></li></ul><h3 id="3.-Apply-Interpolation" tabindex="-1">3. Apply Interpolation <a class="header-anchor" href="#3.-Apply-Interpolation" aria-label="Permalink to &quot;3. Apply Interpolation {#3.-Apply-Interpolation}&quot;">​</a></h3><ul><li><p>Test neighbor interpolation method</p></li><li><p>Test spherical spline method</p></li><li><p>Store original data for comparison</p></li></ul><h3 id="4.-Validate-Repair-Quality" tabindex="-1">4. Validate Repair Quality <a class="header-anchor" href="#4.-Validate-Repair-Quality" aria-label="Permalink to &quot;4. Validate Repair Quality {#4.-Validate-Repair-Quality}&quot;">​</a></h3><ul><li><p>Compare interpolated vs. original data</p></li><li><p>Verify that interpolation changed the data as expected</p></li><li><p>Use visual inspection to confirm successful repair</p></li></ul><h2 id="Code-Examples" tabindex="-1">Code Examples <a class="header-anchor" href="#Code-Examples" aria-label="Permalink to &quot;Code Examples {#Code-Examples}&quot;">​</a></h2><details class="details custom-block"><summary>Show Code</summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EegFun</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GLMakie</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># read raw data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dat </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EegFun</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">read_raw_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./resources/data/example1.bdf&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># read and preprate layout file</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">layout_file </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EegFun</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">read_layout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./resources/layouts/biosemi/biosemi72.csv&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">EegFun</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">polar_to_cartesian_xy!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(layout_file)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dat </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EegFun</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">create_eeg_dataframe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dat, layout_file)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">EegFun</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">rereference!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dat, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:avg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">EegFun</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">highpass_filter!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dat, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Select a few channels to repair</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">test_channels </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:Fp1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">available_channels </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">layout</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">label</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">channels_to_repair </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ch </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ch </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> available_channels, test_channels)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Calculate neighbors first</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">EegFun</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">get_neighbours_xyz!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">layout, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Store original data for comparison</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">original_data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> copy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Try neighbor interpolation</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">EegFun</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">repair_channels!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dat, channels_to_repair, method </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :neighbor_interpolation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Try spherical spline</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">EegFun</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">repair_channels!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dat, channels_to_repair, method </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :spherical_spline</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Check if data changed (using isapprox to handle floating point precision)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data_changed </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">isapprox</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.(dat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ch], original_data[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ch], rtol </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1e-10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ch </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> channels_to_repair)</span></span></code></pre></div></details><h2 id="See-Also" tabindex="-1">See Also <a class="header-anchor" href="#See-Also" aria-label="Permalink to &quot;See Also {#See-Also}&quot;">​</a></h2><ul><li><a href="./../reference/">API Reference</a></li></ul>`,36)])])}const c=s(l,[["render",t]]);export{E as __pageData,c as default};
